// ... existing code ...

// Bá» comment dÃ²ng sau Ä‘á»ƒ cháº¡y thá»­ Study Checklist Ä‘á»™c láº­p
// showChecklistMenu(); 

// --- á»¨ng dá»¥ng Báº£ng xáº¿p háº¡ng (Leaderboard) ---
class Player {
  constructor(name, score) {
    this.name = name;
    this.score = score;
    this.date = new Date().toLocaleDateString('vi-VN');
  }
}

class Leaderboard {
  constructor() {
    this.players = [];
  }

  // ThÃªm ngÆ°á»i chÆ¡i má»›i
  addPlayer(name, score) {
    if (!name || name.trim() === '') {
      throw new Error('TÃªn ngÆ°á»i chÆ¡i khÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng.');
    }
    if (isNaN(score) || score < 0) {
      throw new Error('Äiá»ƒm sá»‘ pháº£i lÃ  sá»‘ dÆ°Æ¡ng.');
    }
    
    const player = new Player(name.trim(), Number(score));
    this.players.push(player);
    this.sortByScore(); // Tá»± Ä‘á»™ng sáº¯p xáº¿p sau khi thÃªm
    console.log(`ÄÃ£ thÃªm ngÆ°á»i chÆ¡i: ${player.name} vá»›i ${player.score} Ä‘iá»ƒm`);
  }

  // Sáº¯p xáº¿p theo Ä‘iá»ƒm sá»‘ giáº£m dáº§n
  sortByScore() {
    this.players.sort((a, b) => b.score - a.score);
  }

  // Hiá»ƒn thá»‹ báº£ng xáº¿p háº¡ng
  displayLeaderboard() {
    if (this.players.length === 0) {
      console.log('Báº£ng xáº¿p háº¡ng trá»‘ng.');
      return;
    }

    console.log('\nğŸ† Báº¢NG Xáº¾P Háº NG ğŸ†');
    console.log('â”€'.repeat(60));
    console.log('Háº¡ng | TÃªn ngÆ°á»i chÆ¡i'.padEnd(30) + '| Äiá»ƒm sá»‘'.padEnd(15) + '| NgÃ y');
    console.log('â”€'.repeat(60));

    this.players.forEach((player, index) => {
      const rank = index + 1;
      const rankSymbol = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : rank === 3 ? 'ğŸ¥‰' : `${rank}.`;
      const name = player.name.padEnd(25);
      const score = player.score.toString().padEnd(10);
      console.log(`${rankSymbol.padEnd(5)} | ${name} | ${score} | ${player.date}`);
    });
    console.log('â”€'.repeat(60));
  }

  // TÃ¬m kiáº¿m ngÆ°á»i chÆ¡i
  searchPlayer(name) {
    const lowerName = name.toLowerCase();
    const found = this.players.filter(p => 
      p.name.toLowerCase().includes(lowerName)
    );
    
    if (found.length === 0) {
      console.log(`KhÃ´ng tÃ¬m tháº¥y ngÆ°á»i chÆ¡i cÃ³ tÃªn "${name}"`);
      return;
    }
    
    console.log(`\nKáº¿t quáº£ tÃ¬m kiáº¿m cho "${name}":`);
    found.forEach(player => {
      const rank = this.players.findIndex(p => p.name === player.name) + 1;
      console.log(`Háº¡ng ${rank}: ${player.name} - ${player.score} Ä‘iá»ƒm (${player.date})`);
    });
  }

  // XÃ³a ngÆ°á»i chÆ¡i
  removePlayer(name) {
    const index = this.players.findIndex(p => p.name.toLowerCase() === name.toLowerCase());
    if (index === -1) {
      throw new Error(`KhÃ´ng tÃ¬m tháº¥y ngÆ°á»i chÆ¡i "${name}"`);
    }
    const [removed] = this.players.splice(index, 1);
    console.log(`ÄÃ£ xÃ³a ngÆ°á»i chÆ¡i: ${removed.name}`);
  }

  // Thá»‘ng kÃª
  getStats() {
    if (this.players.length === 0) {
      console.log('ChÆ°a cÃ³ dá»¯ liá»‡u thá»‘ng kÃª.');
      return;
    }

    const totalPlayers = this.players.length;
    const avgScore = this.players.reduce((sum, p) => sum + p.score, 0) / totalPlayers;
    const topScore = this.players[0].score;
    const lowestScore = this.players[this.players.length - 1].score;

    console.log('\nğŸ“Š THá»NG KÃŠ');
    console.log(`Tá»•ng sá»‘ ngÆ°á»i chÆ¡i: ${totalPlayers}`);
    console.log(`Äiá»ƒm cao nháº¥t: ${topScore}`);
    console.log(`Äiá»ƒm tháº¥p nháº¥t: ${lowestScore}`);
    console.log(`Äiá»ƒm trung bÃ¬nh: ${avgScore.toFixed(1)}`);
  }
}

// Khá»Ÿi táº¡o leaderboard vÃ  giao diá»‡n
const leaderboard = new Leaderboard();
const rl4 = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

function showLeaderboardMenu() {
  console.log('\nğŸ† QUáº¢N LÃ Báº¢NG Xáº¾P Háº NG ğŸ†');
  console.log('1. ThÃªm ngÆ°á»i chÆ¡i');
  console.log('2. Hiá»ƒn thá»‹ báº£ng xáº¿p háº¡ng');
  console.log('3. TÃ¬m kiáº¿m ngÆ°á»i chÆ¡i');
  console.log('4. XÃ³a ngÆ°á»i chÆ¡i');
  console.log('5. Thá»‘ng kÃª');
  console.log('0. ThoÃ¡t');
  rl4.question('Chá»n chá»©c nÄƒng: ', handleLeaderboardMenu);
}

function handleLeaderboardMenu(choice) {
  switch (choice.trim()) {
    case '1':
      addPlayerFlow();
      break;
    case '2':
      leaderboard.displayLeaderboard();
      showLeaderboardMenu();
      break;
    case '3':
      searchPlayerFlow();
      break;
    case '4':
      removePlayerFlow();
      break;
    case '5':
      leaderboard.getStats();
      showLeaderboardMenu();
      break;
    case '0':
      rl4.close();
      break;
    default:
      console.log('Lá»±a chá»n khÃ´ng há»£p lá»‡.');
      showLeaderboardMenu();
  }
}

function addPlayerFlow() {
  rl4.question('Nháº­p tÃªn ngÆ°á»i chÆ¡i: ', (name) => {
    rl4.question('Nháº­p Ä‘iá»ƒm sá»‘: ', (score) => {
      try {
        leaderboard.addPlayer(name, score);
      } catch (e) {
        console.error('Lá»—i:', e.message);
      }
      showLeaderboardMenu();
    });
  });
}

function searchPlayerFlow() {
  rl4.question('Nháº­p tÃªn ngÆ°á»i chÆ¡i cáº§n tÃ¬m: ', (name) => {
    leaderboard.searchPlayer(name);
    showLeaderboardMenu();
  });
}

function removePlayerFlow() {
  rl4.question('Nháº­p tÃªn ngÆ°á»i chÆ¡i cáº§n xÃ³a: ', (name) => {
    try {
      leaderboard.removePlayer(name);
    } catch (e) {
      console.error('Lá»—i:', e.message);
    }
    showLeaderboardMenu();
  });
}

rl4.on('close', () => {
  console.log('ÄÃ£ thoÃ¡t á»©ng dá»¥ng Báº£ng xáº¿p háº¡ng.');
});

// Bá» comment dÃ²ng sau Ä‘á»ƒ cháº¡y thá»­ Leaderboard Ä‘á»™c láº­p
// showLeaderboardMenu();
